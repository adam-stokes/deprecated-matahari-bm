<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Matahari.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Matahari-Testing_Agent">
  <title>We like quality software so please test</title>
  <para>
    For now Cxxtest is the choice of testing platform. It's cross platform
    and for the most part easy to get up to speed on.

  <important>
    <para><application>mingw32-cxxtest</application>
        is needed if wanting to build
        test cases for Windows platform.
        <footnote> 
          <para>
          <ulink url="https://bugzilla.redhat.com/show_bug.cgi?id=708473">mingw32-cxxtest - Red Hat package review</ulink>
          </para>
        </footnote>
    </para>
  </important>
  </para>
  <section>
    <title>Defining the Test Suite</title>
    <para>
      Create <application>matahari/src/tests/mh_api_test.h</application> and include
      the following.

<programlisting language="C++">
<![CDATA[
#ifndef __MH_API_TEST_UNITTEST_H
#define __MH_API_TEST_UNITTEST_H
#include <iostream>
#include <string>
#include <sstream>
#include <utility>
#include <vector>
#include <cstdlib>
#include <cstdio>
#include <sys/stat.h>
#include <dirent.h>
#include <cxxtest/TestSuite.h>

extern "C" {
#include "matahari/test.h"
#include <glib.h>
#include "mh_test_utilities.h"
};

using namespace std;

class MhApiTestSuite : public CxxTest::TestSuite
{
 public:

    void testAddition(void)
    {
        TS_ASSERT((mh_plus(2,2)) == 4);
    }
};

#endif
]]>
</programlisting>
    </para>
  </section>
  <section>
    <title>Building tests with CMake</title>
    <para>
      CMake provides a macro for CxxTest which enables a seamless
      integration with the build process.

<programlisting language="CMake">
<![CDATA[
set(CXXTEST_USE_PYTHON TRUE)
find_package(CxxTest)
if(CXXTEST_FOUND)
   include_directories(${CXXTEST_INCLUDE_DIR})
   ENABLE_TESTING()
   CXXTEST_ADD_TEST(mh_test_unittest test_unittest.cpp ${CMAKE_CURRENT_SOURCE_DIR}/mh_api_test.h)
endif(CXXTEST_FOUND)
]]>
</programlisting>

    </para>
  </section>
</chapter>

