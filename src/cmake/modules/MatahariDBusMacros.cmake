# Generator for files specific to DBus interface

# This macro takes name of the API and then creates two files
# matahari-${API}-dbus-glue.h and matahari-${API}-dbus-properties.h
# First one contains gobject definition generated by dbus-binding-tool
# Second one is definition of properties of the object

macro(generate_dbus_headers API XML)
    find_file(XSLTPROC xsltproc)
    find_file(BIND_TOOL dbus-binding-tool)
    
    # Convert dbus interface to glue and properties files
    add_custom_command(
        OUTPUT ${API}-dbus-glue.h
        COMMAND ${BIND_TOOL} --prefix=matahari --mode=glib-server
            --output=${API}-dbus-glue.h
            ${XML}
        COMMENT "Generating ${API}-dbus-glue.h"
    )

    add_custom_command(
        OUTPUT ${API}-dbus-properties.h
        COMMAND ${XSLTPROC} --output ${API}-dbus-properties.h
            ${CMAKE_CURRENT_SOURCE_DIR}/../dbus-to-c.xsl
            ${XML}
        COMMENT "Generating ${API}-dbus-properties.h"
    )
endmacro(generate_dbus_headers)
